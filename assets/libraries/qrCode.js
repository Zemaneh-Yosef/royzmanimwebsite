/*! QR Code Generator, Dan Jackson, 2020-2025 */
class BitBuffer{constructor(t){this.bitCapacity=t;const e=this.bitCapacity+7>>3;this.buffer=new Uint8Array(e),this.bitOffset=0}append(t,e){for(let i=0;i<e;i++){const n=this.buffer[this.bitOffset>>3],r=1<<7-(7&this.bitOffset),o=1<<e-1-i;this.buffer[this.bitOffset>>3]=n&~r|(t&o?r:0),this.bitOffset++}}position(){return this.bitOffset}read(t){return this.buffer[t>>3]&1<<7-(7&t)?1:0}}class SegmentNumeric{static MODE=1;static CHARSET="0123456789";static canEncode(t){return[...t].every((t=>SegmentNumeric.CHARSET.includes(t)))}static payloadSize(t){const e=t.length;return 10*Math.floor(e/3)+e%3*4-Math.floor(e%3/2)}static countSize(t){return t<10?10:t<27?12:14}static totalSize(t,e){return Segment.MODE_BITS+SegmentNumeric.countSize(t)+SegmentNumeric.payloadSize(e)}static encode(t,e,i){const n=[...i].map((t=>t.charCodeAt(0)-48));t.append(SegmentNumeric.MODE,Segment.MODE_BITS),t.append(n.length,SegmentNumeric.countSize(e));for(let e=0;e<n.length;){n.length-e>3||n.length;let i=n[e],r=4;e++,e<n.length&&(i=10*i+n[e],r+=3,e++),e<n.length&&(i=10*i+n[e],r+=3,e++),t.append(i,r)}}}class SegmentAlphanumeric{static MODE=2;static CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";static canEncode(t){return[...t].every((t=>SegmentAlphanumeric.CHARSET.includes(t)))}static payloadSize(t){const e=t.length;return 11*Math.floor(e/2)+e%2*6}static countSize(t){return t<10?9:t<27?11:13}static totalSize(t,e){return Segment.MODE_BITS+SegmentAlphanumeric.countSize(t)+SegmentAlphanumeric.payloadSize(e)}static encode(t,e,i){const n=[...i].map((t=>SegmentAlphanumeric.CHARSET.indexOf(t)));t.append(SegmentAlphanumeric.MODE,Segment.MODE_BITS),t.append(n.length,SegmentAlphanumeric.countSize(e));for(let e=0;e<n.length;){let i=n[e],r=6;e++,e<n.length&&(i=45*i+n[e],r+=5,e++),t.append(i,r)}}}class SegmentEightBit{static MODE=4;static canEncode(t){return[...t].every((t=>t.charCodeAt(0)>=0&&t.charCodeAt(0)<=255))}static payloadSize(t){return 8*t.length}static countSize(t){return t<10?8:16}static totalSize(t,e){return Segment.MODE_BITS+SegmentEightBit.countSize(t)+SegmentEightBit.payloadSize(e)}static encode(t,e,i){const n=[...i].map((t=>t.charCodeAt(0)));t.append(SegmentEightBit.MODE,Segment.MODE_BITS),t.append(n.length,SegmentEightBit.countSize(e));for(let e=0;e<n.length;e++)t.append(n[e],8)}}class Segment{static MODES={numeric:SegmentNumeric,alphanumeric:SegmentAlphanumeric,eightBit:SegmentEightBit};static MODE_BITS=4;static MODE_INDICATOR_TERMINATOR=0;constructor(t){this.text=t;for(let t of Object.values(Segment.MODES))if(t.canEncode(this.text))return void(this.mode=t);throw"Cannot encode text"}}class ReedSolomon{static Multiply(t,e){let i=0;for(let n=7;n>=0;n--)i=255&(i<<1^285*(i>>7)),i^=(e>>n&1)*t;return i}static Divisor(t){const e=new Uint8Array(t);e.fill(0),e[t-1]=1;let i=1;for(let n=0;n<t;n++){for(let n=0;n<t;n++)e[n]=ReedSolomon.Multiply(e[n],i),n+1<t&&(e[n]^=e[n+1]);i=255&ReedSolomon.Multiply(i,2)}return e}static Remainder(t,e,i,n,r,o,s){o.fill(0,s,s+r);for(let a=0;a<i;a++){let i=t[e+a]^o[s+0];o.copyWithin(s,s+1,s+1+r-1),o[s+r-1]=0;for(let t=0;t<r;t++)o[s+t]^=ReedSolomon.Multiply(n[t],i)}}}class Matrix{static MODULE_LIGHT=0;static MODULE_DARK=1;static FINDER_SIZE=7;static TIMING_OFFSET=6;static VERSION_SIZE=3;static ALIGNMENT_RADIUS=2;static QUIET_NONE=0;static QUIET_STANDARD=4;static calculateDimension(t){return 17+4*t}static calculateMask(t,e,i){switch(t){case 0:return 0==(i+e&1);case 1:return 0==(1&i);case 2:return e%3==0;case 3:return(i+e)%3==0;case 4:return 0==((i>>1)+(e/3|0)&1);case 5:return(i*e&1)+i*e%3==0;case 6:return 0==((i*e&1)+i*e%3&1);case 7:return 0==(i*e%3+(i+e&1)&1);default:return!1}}static alignmentCoordinates(t){const e=t<=1?0:Math.floor(t/7)+2,i=Array(e),n=32==t?26:2*Math.floor((4*t+2*e+1)/(2*e-2));let r=4*t+10;for(let t=e-1;t>0;t--)i[t]=r,r-=n;return e>0&&(i[0]=6),i}constructor(t){this.version=t,this.dimension=Matrix.calculateDimension(this.version);const e=this.dimension*this.dimension;this.buffer=new Array(e),this.identity=new Array(e),this.quiet=Matrix.QUIET_STANDARD,this.invert=!1,this.text=null}setModule(t,e,i,n){if(t<0||e<0||t>=this.dimension||e>=this.dimension)return;const r=e*this.dimension+t;this.buffer[r]=i,void 0!==n&&(this.identity[r]=n)}getModule(t,e){if(t<0||e<0||t>=this.dimension||e>=this.dimension)return null;const i=e*this.dimension+t;return this.buffer[i]}identifyModule(t,e){if(t<0||e<0||t>=this.dimension||e>=this.dimension)return;const i=e*this.dimension+t;return this.identity[i]}drawFinder(t,e){for(let i=-Math.floor(Matrix.FINDER_SIZE/2)-1;i<=Math.floor(Matrix.FINDER_SIZE/2)+1;i++)for(let n=-Math.floor(Matrix.FINDER_SIZE/2)-1;n<=Math.floor(Matrix.FINDER_SIZE/2)+1;n++){let r=1&(Math.abs(n)>Math.abs(i)?Math.abs(n):Math.abs(i))?Matrix.MODULE_DARK:Matrix.MODULE_LIGHT;0==n&&0==i&&(r=Matrix.MODULE_DARK);const o=0==n&&0==i?"FI":"Fi";this.setModule(t+n,e+i,r,o)}}drawTiming(){for(let t=Matrix.FINDER_SIZE+1;t<this.dimension-Matrix.FINDER_SIZE-1;t++){let e=1&~t?Matrix.MODULE_DARK:Matrix.MODULE_LIGHT;this.setModule(t,Matrix.TIMING_OFFSET,e,"Ti"),this.setModule(Matrix.TIMING_OFFSET,t,e,"Ti")}}drawAlignment(t,e){for(let i=-Matrix.ALIGNMENT_RADIUS;i<=Matrix.ALIGNMENT_RADIUS;i++)for(let n=-Matrix.ALIGNMENT_RADIUS;n<=Matrix.ALIGNMENT_RADIUS;n++){let r=1-(1&(Math.abs(n)>Math.abs(i)?Math.abs(n):Math.abs(i)))?Matrix.MODULE_DARK:Matrix.MODULE_LIGHT;const o=0==n&&0==i?"AL":"Al";this.setModule(t+n,e+i,r,o)}}populateFunctionPatterns(){this.drawFinder(Math.floor(Matrix.FINDER_SIZE/2),Math.floor(Matrix.FINDER_SIZE/2)),this.drawFinder(this.dimension-1-Math.floor(Matrix.FINDER_SIZE/2),Math.floor(Matrix.FINDER_SIZE/2)),this.drawFinder(Math.floor(Matrix.FINDER_SIZE/2),this.dimension-1-Math.floor(Matrix.FINDER_SIZE/2)),this.drawTiming();const t=Matrix.alignmentCoordinates(this.version);for(let e of t)for(let i of t)e<=Matrix.FINDER_SIZE&&i<=Matrix.FINDER_SIZE||e>=this.dimension-1-Matrix.FINDER_SIZE&&i<=Matrix.FINDER_SIZE||e<=Matrix.FINDER_SIZE&&i>=this.dimension-1-Matrix.FINDER_SIZE||this.drawAlignment(e,i);this.drawFormatInfo(0),this.drawVersionInfo(0)}cursorReset(){this.cursorX=this.dimension-1,this.cursorY=this.dimension-1}cursorAdvance(){for(;this.cursorX>=0;)if(1&this.cursorX^(this.cursorX>Matrix.TIMING_OFFSET?1:0)?this.cursorX--:(this.cursorX++,(this.cursorX-(this.cursorX>Matrix.TIMING_OFFSET?1:0))/2&1?this.cursorY<=0?this.cursorX-=2:this.cursorY--:this.cursorY>=this.dimension-1?this.cursorX-=2:this.cursorY++),!this.identifyModule(this.cursorX,this.cursorY))return!0;return!1}cursorWrite(t,e,i){let n=e;for(let e=0;e<i;e++){let e=t.read(n);if(this.setModule(this.cursorX,this.cursorY,e),n++,!this.cursorAdvance())break}return n-e}drawFormatInfo(t){const e="Fo";for(let i=0;i<15;i++){const n=t>>i&1;i<6?this.setModule(Matrix.FINDER_SIZE+1,i,n,e):6==i?this.setModule(Matrix.FINDER_SIZE+1,Matrix.FINDER_SIZE,n,e):7==i?this.setModule(Matrix.FINDER_SIZE+1,Matrix.FINDER_SIZE+1,n,e):8==i?this.setModule(Matrix.FINDER_SIZE,Matrix.FINDER_SIZE+1,n,e):this.setModule(14-i,Matrix.FINDER_SIZE+1,n,e),i<8?this.setModule(this.dimension-1-i,Matrix.FINDER_SIZE+1,n,e):this.setModule(Matrix.FINDER_SIZE+1,this.dimension-Matrix.FINDER_SIZE-8+i,n,e)}this.setModule(Matrix.FINDER_SIZE+1,this.dimension-1-Matrix.FINDER_SIZE,Matrix.MODULE_DARK,e)}drawVersionInfo(t){if(!(null===t||this.version<7))for(let e=0;e<18;e++){const i=t>>e&1,n=Math.floor(e/Matrix.VERSION_SIZE),r=e%Matrix.VERSION_SIZE;this.setModule(n,this.dimension-1-Matrix.FINDER_SIZE-Matrix.VERSION_SIZE+r,i,"Ve"),this.setModule(this.dimension-1-Matrix.FINDER_SIZE-Matrix.VERSION_SIZE+r,n,i,"Ve")}}applyMaskPattern(t){for(let e=0;e<this.dimension;e++)for(let i=0;i<this.dimension;i++){if(!this.identifyModule(i,e)){if(Matrix.calculateMask(t,i,e)){const t=1^this.getModule(i,e);this.setModule(i,e,t)}}}}evaluatePenalty(){let t=0;for(let e=0;e<=1;e++){let i=Array(5),n=0;for(let r=0;r<this.dimension;r++){let o=-1,s=0;for(let a=0;a<this.dimension;a++){let l=this.getModule(e?r:a,e?a:r);if(l==o&&s++,l!=o||a>=this.dimension-1){if(o>=0&&(s>=5&&(t+=s-5+3),n++,i[n%5]=s,n>=5)){let e=i[(n+1)%5];i[n%5]==3*e&&e==i[(n+2)%5]&&e==i[(n+3)%5]&&e==i[(n+4)%5]&&(t+=40)}s=1,o=l}}}}for(let e=0;e<this.dimension-1;e++)for(let i=0;i<this.dimension-1;i++){let n=this.getModule(i,e);n+=this.getModule(i+1,e),n+=this.getModule(i,e+1),n+=this.getModule(i+1,e+1),0!=n&&4!=n||(t+=3)}{let e=0;for(let t=0;t<this.dimension;t++)for(let i=0;i<this.dimension;i++){this.getModule(i,t)==Matrix.MODULE_DARK&&e++}let i=(100*e+this.dimension*this.dimension/2)/(this.dimension*this.dimension),n=Math.abs(i-50);t+=10*Math.floor(n/5)}return t}}class QrCode{static VERSION_MIN=1;static VERSION_MAX=40;static ErrorCorrectionLevel={L:1,M:0,Q:3,H:2};static ECC_CODEWORDS_MAX=30;static PAD_CODEWORDS=60433;static dimension(t){return 17+4*t}static totalDataModules(t){return(16*t+128)*t+64-(t<2?0:(25*(Math.floor(t/7)+2)-10)*(Math.floor(t/7)+2)-55)-(t<7?0:36)}static dataCapacity(t,e){return 8*(Math.floor(QrCode.totalDataModules(t)/8)-QrCode.eccBlockCodewords(t,e)*QrCode.eccBlockCount(t,e))}static eccBlockCount(t,e){return[[0,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[0,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[0,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81],[0,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68]][e][t]}static eccBlockCodewords(t,e){return[[0,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[0,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[0,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[0,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30]][e][t]}static calculateVersionInfo(t){if(t<7)return null;let e=t;for(let t=0;t<12;t++)e=e<<1^7973*(e>>>11);return t<<12|e}static calculateFormatInfo(t,e){const i=(3&t)<<3|7&e;let n=i;for(let t=0;t<10;t++)n=n<<1^1335*(n>>>9);let r=i<<10|1023&n;return r^=21522,r}static measureSegments(t,e){let i=0;for(let n of t)i+=n.mode.totalSize(e,n.text);return i}static doSegmentsFit(t,e,i){return QrCode.measureSegments(t,e)<=QrCode.dataCapacity(e,i)}static findMinimumVersion(t,e,i=QrCode.VERSION_MIN,n=QrCode.VERSION_MAX){for(let r=i;r<=n;r++)if(QrCode.doSegmentsFit(t,r,e))return r;throw"Cannot fit data in any allowed versions"}static tryToImproveErrorCorrectionLevel(t,e,i){const n=Object.values(QrCode.ErrorCorrectionLevel);for(let r=1;r<n.length;r++)i==n[r-1]&&QrCode.doSegmentsFit(t,e,n[r])&&(i=n[r]);return i}static writeData(t,e,i){for(let n of i)n.mode.encode(t,e,n.text)}static writePadding(t,e,i){const n=QrCode.dataCapacity(e,i);let r;for(r=Math.min(n-t.position(),Segment.MODE_BITS),t.append(Segment.MODE_INDICATOR_TERMINATOR,r),r=Math.min(n-t.position(),8-(7&t.position())&7),t.append(0,r);(r=Math.min(n-t.position(),16))>0;)t.append(QrCode.PAD_CODEWORDS>>16-r,r)}static calculateEccAndFillMatrix(t,e,i,n){const r=QrCode.eccBlockCount(e,i),o=QrCode.eccBlockCodewords(e,i),s=QrCode.totalDataModules(e),a=Math.floor((s-8*o*r)/8),l=ReedSolomon.Divisor(o),d=a,c=Math.floor(d/r),u=r-(d-c*r),h=c+(u>=r?0:1);for(let e=0;e<r;e++){let i;i=e<u?e*c:e*c+(e-u);let n=c+(e<u?0:1),r=a+e*o;ReedSolomon.Remainder(t.buffer,i,n,l,o,t.buffer,r)}n.cursorReset();let f=0;for(let e=0;e<h;e++)for(let i=0;i<r;i++){if(e>=c&&i<u)continue;const r=8*(i*c+(i>u?i-u:0)+e),o=8;f+=n.cursorWrite(t,r,o)}for(let e=0;e<o;e++)for(let i=0;i<r;i++){const r=8*a+i*o*8+8*e,s=8;f+=n.cursorWrite(t,r,s)}const M=Matrix.MODULE_LIGHT;for(;f<s&&(n.setModule(n.cursorX,n.cursorY,M),f++,n.cursorAdvance()););}static findOptimalMaskPattern(t,e){let i=-1,n=null;for(let r=0;r<=7;r++){t.applyMaskPattern(r);const o=QrCode.calculateFormatInfo(e,r);t.drawFormatInfo(o);const s=t.evaluatePenalty();t.applyMaskPattern(r),(i<0||s<i)&&(i=s,n=r)}return n}constructor(){}static generate(t,e){const i=Object.assign({errorCorrectionLevel:QrCode.ErrorCorrectionLevel.M,minVersion:QrCode.VERSION_MIN,maxVersion:QrCode.VERSION_MAX,optimizeEcc:!0,maskPattern:null,quiet:Matrix.QUIET_STANDARD,invert:!1},e),n=(Array.isArray(t)?t:[t]).map((t=>new Segment(t)));let r=i.errorCorrectionLevel;const o=QrCode.findMinimumVersion(n,r,i.minVersion,i.maxVersion);i.optimizeEcc&&(r=QrCode.tryToImproveErrorCorrectionLevel(n,o,r));const s=QrCode.totalDataModules(o),a=new BitBuffer(s);QrCode.writeData(a,o,n),QrCode.writePadding(a,o,r);const l=new Matrix(o);l.text=t,l.quiet=i.quiet,l.invert=i.invert,l.populateFunctionPatterns(),QrCode.calculateEccAndFillMatrix(a,o,r,l);let d=i.maskPattern;null===d&&(d=QrCode.findOptimalMaskPattern(l,r)),l.applyMaskPattern(d);const c=QrCode.calculateVersionInfo(o);l.drawVersionInfo(c);const u=QrCode.calculateFormatInfo(r,d);return l.drawFormatInfo(u),l}static render(t,e,i){const n={debug:renderDebug,large:renderTextLarge,medium:renderTextMedium,compact:renderTextCompact,svg:renderSvg,"svg-uri":renderSvgUri,bmp:renderBmp,"bmp-uri":renderBmpUri,sixel:renderSixel,tgp:renderTerminalGraphicsProtocol,iip:renderInlineImagesProtocol};if(canRenderPng()&&(n.png=renderPngBlob),!n[t])throw new Error("ERROR: Invalid render mode: "+t);return n[t](e,i)}}function BitmapGenerate(t,e,i,n=!1){const r=n?32:24,o={BITMAPCOREHEADER:12,BITMAPINFOHEADER:40,BITMAPV2INFOHEADER:52,BITMAPV3INFOHEADER:56,BITMAPV4HEADER:108,BITMAPV5HEADER:124},s=n?"BITMAPV4HEADER":"BITMAPCOREHEADER";if(!o.hasOwnProperty(s))throw`Unknown BMP header version: ${s}`;const a=o[s],l=4*Math.floor((e*Math.floor((r+7)/8)+3)/4),d=l*Math.abs(i),c=14+a,u=c+d,h=new ArrayBuffer(u),f=new DataView(h);if(f.setUint8(0,"B".charCodeAt(0)),f.setUint8(1,"M".charCodeAt(0)),f.setUint32(2,u,!0),f.setUint16(6,0,!0),f.setUint16(8,0,!0),f.setUint32(10,c,!0),a==o.BITMAPCOREHEADER?(f.setUint32(14,a,!0),f.setUint16(18,e,!0),f.setInt16(20,i,!0),f.setUint16(22,1,!0),f.setUint16(24,r,!0)):a>=o.BITMAPINFOHEADER&&(f.setUint32(14,a,!0),f.setUint32(18,e,!0),f.setInt32(22,i,!0),f.setUint16(26,1,!0),f.setUint16(28,r,!0),f.setUint32(30,n?3:0,!0),f.setUint32(34,d,!0),f.setUint32(38,2835,!0),f.setUint32(42,2835,!0),f.setUint32(46,0,!0),f.setUint32(50,0,!0)),a>=o.BITMAPV2INFOHEADER&&(f.setUint32(54,n?16711680:0,!0),f.setUint32(58,n?65280:0,!0),f.setUint32(62,n?255:0,!0)),a>=o.BITMAPV3INFOHEADER&&f.setUint32(66,n?4278190080:0,!0),a>=o.BITMAPV4HEADER){const t="Win ";f.setUint8(70,t.charCodeAt(0)),f.setUint8(71,t.charCodeAt(1)),f.setUint8(72,t.charCodeAt(2)),f.setUint8(73,t.charCodeAt(3)),f.setUint32(110,0,!0),f.setUint32(114,0,!0),f.setUint32(118,0,!0)}a>=o.BITMAPV5HEADER&&(f.setUint32(122,4,!0),f.setUint32(126,0,!0),f.setUint32(130,0,!0),f.setUint32(134,0,!0));for(let r=0;r<i;r++){let o=c+(i-1-r)*l;for(let i=0;i<e;i++){const s=t[r*e+i];f.setUint8(o+0,s[2]),f.setUint8(o+1,s[1]),f.setUint8(o+2,s[0]),n?(f.setUint8(o+3,s[3]),o+=4):o+=3}}return h}function renderDebug(t,e){e=Object.assign({segments:["  ","â–ˆâ–ˆ"],sep:"\n"},e);const i=[];for(let n=-t.quiet;n<t.dimension+t.quiet;n++){const r=[];for(let i=-t.quiet;i<t.dimension+t.quiet;i++){let o=t.identifyModule(i,n);const s=(t.getModule(i,n)?!t.invert:t.invert)?1:0;null==o&&(o=e.segments[s]),r.push(o)}i.push(r.join(""))}return i.join(e.sep)}function renderTextLarge(t,e){e=Object.assign({segments:["  ","â–ˆâ–ˆ"],sep:"\n"},e);const i=[];for(let n=-t.quiet;n<t.dimension+t.quiet;n++){const r=[];for(let i=-t.quiet;i<t.dimension+t.quiet;i++){const o=t.getModule(i,n)?!t.invert:t.invert,s=o?1:0,a=e.segments.length>=3&&o&&!t.identifyModule(i,n)?e.segments[2]:e.segments[s];r.push(a)}i.push(r.join(""))}return i.join(e.sep)}function renderTextMedium(t,e){e=Object.assign({segments:[" ","â–€","â–„","â–ˆ"],sep:"\n"},e);const i=[];for(let n=-t.quiet;n<t.dimension+t.quiet;n+=2){const r=[];for(let i=-t.quiet;i<t.dimension+t.quiet;i++){const o=((t.getModule(i,n)?!t.invert:t.invert)?1:0)|((n+1<t.dimension&&t.getModule(i,n+1)?!t.invert:t.invert)?2:0),s=e.segments[o];r.push(s)}i.push(r.join(""))}return i.join(e.sep)}function renderTextCompact(t,e){e=Object.assign({segments:[" ","â–˜","â–","â–€","â––","â–Œ","â–ž","â–›","â–—","â–š","â–","â–œ","â–„","â–™","â–Ÿ","â–ˆ"],sep:"\n"},e);const i=[];for(let n=-t.quiet;n<t.dimension+t.quiet;n+=2){const r=[];for(let i=-t.quiet;i<t.dimension+t.quiet;i+=2){let o=0;o|=(t.getModule(i,n)?!t.invert:t.invert)?1:0,o|=(i+1<t.dimension&&t.getModule(i+1,n)?!t.invert:t.invert)?2:0,o|=(n+1<t.dimension&&t.getModule(i,n+1)?!t.invert:t.invert)?4:0,o|=(n+1<t.dimension&&i+1<t.dimension&&t.getModule(i+1,n+1)?!t.invert:t.invert)?8:0;let s=e.segments[o];r.push(s)}i.push(r.join(""))}return i.join(e.sep)}function renderSixel(t,e){e=Object.assign({scale:4},e);const i=[];i.push("P7;1q"),i.push("#0;2;0;0;0"),i.push("#1;2;100;100;100");for(let n=-t.quiet*e.scale;n<(t.dimension+t.quiet)*e.scale;n+=6){const r=2;for(let o=0;o<r;o++){i.push("#"+o);for(let r=-t.quiet*e.scale;r<(t.dimension+t.quiet)*e.scale;r+=e.scale){let s=0;for(let i=0;i<6;i++){s|=((((t.getModule(Math.floor(r/e.scale),Math.floor((n+i)/e.scale))?!t.invert:t.invert)?0:1)==o?1:0)?1:0)<<i}const a=(e.scale>3?"!"+e.scale:"")+String.fromCharCode(s+63).repeat(e.scale<=3?e.scale:1);i.push(a)}o+1<r&&i.push("$")}n+6<(t.dimension+t.quiet)*e.scale&&i.push("-")}return i.push("\\"),i.join("")}function renderTerminalGraphicsProtocol(t,e){const i=(e=Object.assign({scale:4,alpha:!1},e)).alpha,n=e.scale,r=t.dimension+2*t.quiet,o=t.dimension+2*t.quiet,s=4096,a=new Uint8Array(r*n*(o*n)*(i?4:3));for(let e=0;e<o*n;e++)for(let o=0;o<r*n;o++){let s=t.getModule(Math.floor(o/n)-t.quiet,Math.floor(e/n)-t.quiet);t.invert&&(s=!s);const l=s?[0,0,0,0]:[255,255,255,255];if(null==l)continue;const d=(e*(r*n)+o)*(i?4:3);a[d+0]=l[0],a[d+1]=l[1],a[d+2]=l[2],i&&(a[d+3]=l[3])}let l=[];const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let t=0;t<a.byteLength;t+=3){let e=a[t]<<16|(t+1<a.byteLength?a[t+1]:0)<<8|(t+2<a.byteLength?a[t+2]:0)<<0;l.push(d[e>>18&63]),l.push(d[e>>12&63]),l.push(d[e>>6&63]),l.push(d[e>>0&63])}a.byteLength%3==1?(l[l.byteLength-1]="=",l[l.byteLength-2]="="):a.byteLength%3==2&&(l[l.byteLength-1]="=");const c=l.join(""),u=[];for(let t=0;t<c.length;t+=s){const e=c.slice(t,t+s),a=0==t?`a=T,f=${i?32:24},s=${r*n},v=${o*n},t=d,q=2,`:"",l=t+s<c.length?1:0;u.push(`_G${a}m=${l};${e}\\`)}return u.join("")}function renderInlineImagesProtocol(t,e){const i=renderBmp(t,e),n=btoa(new Uint8Array(i).reduce(((t,e)=>t+String.fromCharCode(e)),"")),r=null==e||!e.hasOwnProperty("chunked")||e.chunked,o=[];if(r?o.push("]1337;MultipartFile="):o.push("]1337;File="),o.push("name="+btoa("qrcode.bmp")+";"),o.push("size="+i.byteLength+";"),o.push("width="+i.width+"px;"),o.push("height="+i.height+"px;"),o.push("preserveAspectRatio=1;"),o.push("inline=1;"),r){o.push("");const t=65536;for(let e=0;e<n.length;e+=t){const i=n.slice(e,e+t);o.push("]1337;FilePart=",i,"")}o.push("]1337;FileEnd")}else o.push(":",n,"");return o.join("")}function escape(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;")}function renderSvg(t,e){e=Object.assign({color:"currentColor",moduleRound:null,finderRound:null,alignmentRound:null,white:!1,moduleSize:1},e);const i=""+(-t.quiet-e.moduleSize/2),n=""+(2*(t.quiet+e.moduleSize/2)+t.dimension-1),r=[];r.push('<?xml version="1.0"?>'),r.push(`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="${e.color}" viewBox="${i} ${i} ${n} ${n}" shape-rendering="crispEdges">`),r.push(`<title>${escape(t.text)}</title>`),r.push("<defs>"),r.push(`<rect id="b" x="${-e.moduleSize/2}" y="${-e.moduleSize/2}" width="${e.moduleSize}" height="${e.moduleSize}" rx="${.5*(e.moduleRound||0)*e.moduleSize}" />`),e.white&&r.push('<path id="w" d="" visibility="hidden" />'),null!=e.finderRound?(r.push('<path id="f" d="" visibility="hidden" />'),e.white&&r.push('<path id="fw" d="" visibility="hidden" />'),r.push(`<g id="fc"><rect x="-3" y="-3" width="6" height="6" rx="${3*e.finderRound}" stroke="${e.color}" stroke-width="1" fill="none" /><rect x="-1.5" y="-1.5" width="3" height="3" rx="${1.5*e.finderRound}" /></g>`),r.push(`<g id="fc"><rect x="-3" y="-3" width="6" height="6" rx="${3*e.finderRound}" stroke="${e.color}" stroke-width="1" fill="none" /><rect x="-1.5" y="-1.5" width="3" height="3" rx="${1.5*e.finderRound}" /></g>`)):(r.push('<use id="f" xlink:href="#b" />'),e.white&&r.push('<use id="fw" xlink:href="#w" />'),r.push('<path id="fc" d="" visibility="hidden" />')),null!=e.alignmentRound?(r.push('<path id="a" d="" visibility="hidden" />'),e.white&&r.push('<path id="aw" d="" visibility="hidden" />'),r.push(`<g id="ac"><rect x="-2" y="-2" width="4" height="4" rx="${2*e.alignmentRound}" stroke="${e.color}" stroke-width="1" fill="none" /><rect x="-0.5" y="-0.5" width="1" height="1" rx="${.5*e.alignmentRound}" /></g>`)):(r.push('<use id="a" xlink:href="#b" />'),e.white&&r.push('<use id="aw" xlink:href="#w" />'),r.push('<path id="ac" d="" visibility="hidden" />')),r.push("</defs>");for(let i=0;i<t.dimension;i++)for(let n=0;n<t.dimension;n++){const o=t.identifyModule(n,i);let s=t.getModule(n,i);t.invert&&(s=!s);let a=s?"b":"w";"Fi"==o||"FI"==o?a=s?"f":"fw":"Al"!=o&&"AL"!=o||(a=s?"a":"aw"),(s||e.white)&&r.push(`<use x="${n}" y="${i}" xlink:href="#${a}" />`)}for(let e=0;e<t.dimension;e++)for(let i=0;i<t.dimension;i++){const n=t.identifyModule(i,e);let o=null;"FI"==n?o="fc":"AL"==n&&(o="ac"),null!=o&&r.push(`<use x="${i}" y="${e}" xlink:href="#${o}" />`)}r.push("</svg>");return r.join("\n")}function renderSvgUri(t,e){return"data:image/svg+xml,"+encodeURIComponent(renderSvg(t,e))}function renderBmp(t,e){e=Object.assign({scale:8,alpha:!1,width:null,height:null},e);const i=t.dimension+2*t.quiet;null===e.width&&(e.width=Math.floor(i*e.scale)),null===e.height&&(e.height=e.width);const n=Array(e.width*e.height).fill(null);for(let r=0;r<e.height;r++){const o=Math.floor(r*i/e.height)-t.quiet;for(let s=0;s<e.width;s++){const a=Math.floor(s*i/e.width)-t.quiet;let l,d=t.getModule(a,o);l=t.invert?d?[255,255,255,255]:[0,0,0,0]:d?[0,0,0,255]:[255,255,255,0],n[r*e.width+s]=l}}const r=BitmapGenerate(n,e.width,e.height,e.alpha);return r.width=e.width,r.height=e.height,r.alpha=e.alpha,r}function renderBmpUri(t,e){const i=renderBmp(t,e);return"data:image/bmp;base64,"+btoa(new Uint8Array(i).reduce(((t,e)=>t+String.fromCharCode(e)),""))}function canRenderPng(){return"function"==typeof URL&&"function"==typeof Image&&"function"==typeof OffscreenCanvas}async function renderPngBlob(t,{size:e=1024,background:i="transparent",...n}){const r=new Image(e,e);r.src=renderSvgUri(t,{...n,white:!1,moduleRound:1,finderRound:.5}),await new Promise((t=>r.addEventListener("load",t,{once:!0})));const o=new OffscreenCanvas(e,e),s=o.getContext("2d");return s.beginPath(),s.fillStyle=i,s.rect(0,0,e,e),s.fill(),s.drawImage(r,0,0,e,e),o.convertToBlob()}export default QrCode;